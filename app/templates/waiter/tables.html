{% extends "waiter/base.html" %}

{% block title %}–°—Ç–æ–ª—ã - –û—Ñ–∏—Ü–∏–∞–Ω—Ç - DENIZ Restaurant{% endblock %}

{% block content %}
<div class="tables-container">
    <div class="page-header">
        <h1>–°—Ç–æ–ª—ã</h1>
        <div class="header-actions">
            <button class="btn btn-secondary" id="refreshTables">
                <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
            </button>
        </div>
    </div>

    <div class="tables-filters">
        <div class="filter-group">
            <label>–°—Ç–∞—Ç—É—Å:</label>
            <select id="statusFilter" class="form-control">
                <option value="">–í—Å–µ</option>
                <option value="free">–°–≤–æ–±–æ–¥–Ω—ã–µ</option>
                <option value="occupied">–ó–∞–Ω—è—Ç—ã–µ</option>
                <option value="reserved">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</option>
                <option value="cleaning">–£–±–æ—Ä–∫–∞</option>
            </select>
        </div>
        <div class="filter-group">
            <label>–ó–æ–Ω–∞:</label>
            <select id="zoneFilter" class="form-control">
                <option value="">–í—Å–µ –∑–æ–Ω—ã</option>
                <option value="main">–û—Å–Ω–æ–≤–Ω–∞—è</option>
                <option value="terrace">–¢–µ—Ä—Ä–∞—Å–∞</option>
                <option value="vip">VIP</option>
            </select>
        </div>
    </div>

    <div class="tables-grid" id="tablesGrid">
        <div class="loading-placeholder">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–æ–ª–æ–≤...</p>
        </div>
    </div>

    <!-- Table Detail Modal -->
    <div class="modal modal-overlay" id="tableDetailModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–æ–ª–µ</h3>
                <button type="button" class="btn-close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body" id="tableDetailContent">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button type="button" class="btn btn-primary" id="updateTableStatus">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('ü™ë Tables page initialized');
    
    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–æ–ª–æ–≤
    async function loadTables() {
        try {
            const statusFilter = document.getElementById('statusFilter').value;
            const zoneFilter = document.getElementById('zoneFilter').value;
            
            const filters = {};
            if (statusFilter) filters.status = statusFilter;
            if (zoneFilter) filters.zone = zoneFilter;
            
            const tablesGrid = document.getElementById('tablesGrid');
            tablesGrid.innerHTML = '<div class="loading-placeholder"><div class="spinner"></div><p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–æ–ª–æ–≤...</p></div>';
            
            // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É
            setTimeout(() => {
                const sampleTables = [
                    { id: 1, number: 1, capacity: 4, status: 'free', zone: 'main' },
                    { id: 2, number: 2, capacity: 2, status: 'occupied', zone: 'main' },
                    { id: 3, number: 3, capacity: 6, status: 'reserved', zone: 'terrace' },
                    { id: 4, number: 4, capacity: 4, status: 'cleaning', zone: 'main' },
                    { id: 5, number: 5, capacity: 8, status: 'free', zone: 'vip' },
                    { id: 6, number: 6, capacity: 2, status: 'occupied', zone: 'terrace' }
                ];
                
                let filteredTables = sampleTables;
                if (statusFilter) {
                    filteredTables = filteredTables.filter(t => t.status === statusFilter);
                }
                if (zoneFilter) {
                    filteredTables = filteredTables.filter(t => t.zone === zoneFilter);
                }
                
                if (filteredTables.length === 0) {
                    tablesGrid.innerHTML = `
                        <div class="no-data">
                            <i class="fas fa-chair"></i>
                            <h3>–°—Ç–æ–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                            <p>–ù–µ—Ç —Å—Ç–æ–ª–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º</p>
                        </div>
                    `;
                    return;
                }
                
                const tablesHtml = filteredTables.map(table => `
                    <div class="table-card table-${table.status}" data-table-id="${table.id}">
                        <div class="table-header">
                            <div class="table-number">–°—Ç–æ–ª ${table.number}</div>
                            <div class="table-status status-${table.status}">
                                ${getStatusText(table.status)}
                            </div>
                        </div>
                        <div class="table-info">
                            <div class="table-capacity">
                                <i class="fas fa-users"></i> –ú–µ—Å—Ç: <strong>${table.capacity}</strong>
                            </div>
                            <div class="table-zone">–ó–æ–Ω–∞: <strong>${getZoneText(table.zone)}</strong></div>
                        </div>
                        <div class="table-actions">
                            <button class="btn btn-sm btn-primary" onclick="showTableDetails(${table.id})">
                                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </button>
                        </div>
                    </div>
                `).join('');
                
                tablesGrid.innerHTML = tablesHtml;
            }, 1000);
            
        } catch (error) {
            console.error('Error loading tables:', error);
            waiterNotifications.showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–æ–ª–æ–≤');
        }
    }
    
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function getStatusText(status) {
        const statusTexts = {
            'free': '–°–≤–æ–±–æ–¥–µ–Ω',
            'occupied': '–ó–∞–Ω—è—Ç',
            'reserved': '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω',
            'cleaning': '–£–±–æ—Ä–∫–∞'
        };
        return statusTexts[status] || status;
    }
    
    function getZoneText(zone) {
        const zoneTexts = {
            'main': '–û—Å–Ω–æ–≤–Ω–∞—è –∑–æ–Ω–∞',
            'terrace': '–¢–µ—Ä—Ä–∞—Å–∞',
            'vip': 'VIP –∑–æ–Ω–∞'
        };
        return zoneTexts[zone] || zone;
    }
    
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –¥–µ—Ç–∞–ª–µ–π —Å—Ç–æ–ª–∞
    window.showTableDetails = function(tableId) {
        console.log('Showing details for table:', tableId);
        waiterModals.show('tableDetailModal');
        
        document.getElementById('tableDetailContent').innerHTML = `
            <div class="table-detail">
                <h4>–°—Ç–æ–ª ${tableId}</h4>
                <p>–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–æ–ª–µ –±—É–¥–µ—Ç –∑–¥–µ—Å—å...</p>
                <p><em>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</em></p>
            </div>
        `;
    };
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    document.getElementById('refreshTables').addEventListener('click', loadTables);
    document.getElementById('statusFilter').addEventListener('change', loadTables);
    document.getElementById('zoneFilter').addEventListener('change', loadTables);
    
    // –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    loadTables();
});
</script>


{% endblock %}