{% extends "waiter/base.html" %}

{% block title %}–°—Ç–æ–ª—ã - –û—Ñ–∏—Ü–∏–∞–Ω—Ç - DENIZ Restaurant{% endblock %}

{% block content %}
<div class="tables-container">
    <div class="page-header">
        <h1>–°—Ç–æ–ª—ã</h1>
        <div class="header-actions">
            <button class="btn btn-secondary" id="refreshTables">
                <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
            </button>
        </div>
    </div>

    <div class="tables-filters">
        <div class="filter-group">
            <label>–°—Ç–∞—Ç—É—Å:</label>
            <select id="statusFilter" class="form-control">
                <option value="">–í—Å–µ</option>
                <option value="free">–°–≤–æ–±–æ–¥–Ω—ã–µ</option>
                <option value="occupied">–ó–∞–Ω—è—Ç—ã–µ</option>
                <option value="reserved">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</option>
                <option value="cleaning">–£–±–æ—Ä–∫–∞</option>
            </select>
        </div>
        <div class="filter-group">
            <label>–ó–æ–Ω–∞:</label>
            <select id="zoneFilter" class="form-control">
                <option value="">–í—Å–µ –∑–æ–Ω—ã</option>
                <option value="main">–û—Å–Ω–æ–≤–Ω–∞—è</option>
                <option value="terrace">–¢–µ—Ä—Ä–∞—Å–∞</option>
                <option value="vip">VIP</option>
            </select>
        </div>
    </div>

    <div class="tables-grid" id="tablesGrid">
        <div class="loading-placeholder">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–æ–ª–æ–≤...</p>
        </div>
    </div>

    <!-- Table Detail Modal -->
    <div class="modal modal-overlay" id="tableDetailModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–æ–ª–µ</h3>
                <button type="button" class="btn-close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body" id="tableDetailContent">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button type="button" class="btn btn-primary" id="updateTableStatus">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('ü™ë Tables page initialized');
    
    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–æ–ª–æ–≤
    async function loadTables() {
        try {
            const statusFilter = document.getElementById('statusFilter').value;
            const zoneFilter = document.getElementById('zoneFilter').value;
            
            const tablesGrid = document.getElementById('tablesGrid');
            tablesGrid.innerHTML = '<div class="loading-placeholder"><div class="spinner"></div><p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–æ–ª–æ–≤...</p></div>';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API
            const response = await fetch('/waiter/api/tables');
            const result = await response.json();
            
            if (result.status !== 'success') {
                throw new Error(result.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–æ–ª–æ–≤');
            }
            
            let tables = result.data.tables || [];
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            if (statusFilter) {
                tables = tables.filter(t => mapStatusToFilter(t.status) === statusFilter);
            }
            
            if (tables.length === 0) {
                tablesGrid.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-chair"></i>
                        <h3>–°—Ç–æ–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                        <p>–ù–µ—Ç —Å—Ç–æ–ª–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º</p>
                    </div>
                `;
                return;
            }
            
            const tablesHtml = tables.map(table => `
                <div class="table-card table-${mapStatusToClass(table.status)}" data-table-id="${table.id}">
                    <div class="table-header">
                        <div class="table-number">–°—Ç–æ–ª ${table.table_number}</div>
                        <div class="table-status status-${mapStatusToClass(table.status)}">
                            ${getStatusText(table.status)}
                        </div>
                    </div>
                    <div class="table-info">
                        <div class="table-capacity">
                            <i class="fas fa-users"></i> –ú–µ—Å—Ç: <strong>${table.capacity}</strong>
                        </div>
                        <div class="table-zone">–ó–æ–Ω–∞: <strong>–û—Å–Ω–æ–≤–Ω–∞—è –∑–æ–Ω–∞</strong></div>
                    </div>
                    <div class="table-actions">
                        <button class="btn btn-sm btn-primary" onclick="showTableDetails(${table.id})">
                            –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                        </button>
                    </div>
                </div>
            `).join('');
            
            tablesGrid.innerHTML = tablesHtml;
            
        } catch (error) {
            console.error('Error loading tables:', error);
            const tablesGrid = document.getElementById('tablesGrid');
            tablesGrid.innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
                    <p>${error.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–æ–ª—ã'}</p>
                </div>
            `;
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –º–∞–ø–ø–∏–Ω–≥–∞ —Å—Ç–∞—Ç—É—Å–∞ –ë–î –≤ –∫–ª–∞—Å—Å CSS
    function mapStatusToClass(status) {
        const statusMap = {
            'available': 'free',
            'occupied': 'occupied',
            'reserved': 'reserved',
            'cleaning': 'cleaning'
        };
        return statusMap[status] || 'free';
    }
    
    // –§—É–Ω–∫—Ü–∏—è –º–∞–ø–ø–∏–Ω–≥–∞ —Å—Ç–∞—Ç—É—Å–∞ –ë–î –≤ —Ñ–∏–ª—å—Ç—Ä
    function mapStatusToFilter(status) {
        const statusMap = {
            'available': 'free',
            'occupied': 'occupied',
            'reserved': 'reserved',
            'cleaning': 'cleaning'
        };
        return statusMap[status] || 'free';
    }
    
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function getStatusText(status) {
        const statusTexts = {
            'available': '–°–≤–æ–±–æ–¥–µ–Ω',
            'occupied': '–ó–∞–Ω—è—Ç',
            'reserved': '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω',
            'cleaning': '–£–±–æ—Ä–∫–∞'
        };
        return statusTexts[status] || status;
    }
    
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –¥–µ—Ç–∞–ª–µ–π —Å—Ç–æ–ª–∞
    window.showTableDetails = function(tableId) {
        console.log('Showing details for table:', tableId);
        waiterModals.show('tableDetailModal');
        
        document.getElementById('tableDetailContent').innerHTML = `
            <div class="table-detail">
                <h4>–°—Ç–æ–ª ${tableId}</h4>
                <p>–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–æ–ª–µ –±—É–¥–µ—Ç –∑–¥–µ—Å—å...</p>
                <p><em>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</em></p>
            </div>
        `;
    };
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    document.getElementById('refreshTables').addEventListener('click', loadTables);
    document.getElementById('statusFilter').addEventListener('change', loadTables);
    document.getElementById('zoneFilter').addEventListener('change', loadTables);
    
    // –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    loadTables();
});
</script>


{% endblock %}