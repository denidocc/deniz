{% extends "waiter/base.html" %}

{% block title %}–°–º–µ–Ω–∞ - –û—Ñ–∏—Ü–∏–∞–Ω—Ç - DENIZ Restaurant{% endblock %}

{% block content %}
<div class="shift-container">
    <div class="page-header">
        <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ–Ω–æ–π</h1>
        <div class="header-actions">
            <button class="btn btn-secondary" id="refreshShift">
                <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
            </button>
        </div>
    </div>

    <!-- Current Shift Status -->
    <div class="shift-status-card">
        <div class="shift-header">
            <h2>–¢–µ–∫—É—â–∞—è —Å–º–µ–Ω–∞</h2>
            <div class="shift-timer" id="shiftTimer">--:--:--</div>
        </div>
        
        <div class="shift-info" id="shiftInfo">
            <div class="loading-placeholder">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–º–µ–Ω–µ...</p>
            </div>
        </div>
        
        <div class="shift-actions">
            <button class="btn btn-success" id="startShiftBtn" style="display: none;">
                <i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å —Å–º–µ–Ω—É
            </button>
            <button class="btn btn-danger" id="endShiftBtn" style="display: none;">
                <i class="fas fa-stop"></i> –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–º–µ–Ω—É
            </button>
        </div>
    </div>

    <!-- Shift Statistics -->
    <div class="shift-stats-card" id="shiftStatsCard" style="display: none;">
        <div class="card-header">
            <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–º–µ–Ω—ã</h3>
        </div>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-icon">üìã</div>
                <div class="stat-content">
                    <div class="stat-label">–ó–∞–∫–∞–∑–æ–≤ –ø—Ä–∏–Ω—è—Ç–æ</div>
                    <div class="stat-value" id="ordersCount">0</div>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon">ü™ë</div>
                <div class="stat-content">
                    <div class="stat-label">–°—Ç–æ–ª–æ–≤ –æ–±—Å–ª—É–∂–µ–Ω–æ</div>
                    <div class="stat-value" id="tablesCount">0</div>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon">üí∞</div>
                <div class="stat-content">
                    <div class="stat-label">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</div>
                    <div class="stat-value" id="totalRevenue">0 ‚Çº</div>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon">‚≠ê</div>
                <div class="stat-content">
                    <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</div>
                    <div class="stat-value" id="avgCheck">0 ‚Çº</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shift History -->
    <div class="shift-history-card">
        <div class="card-header">
            <h3>–ò—Å—Ç–æ—Ä–∏—è —Å–º–µ–Ω</h3>
            <button class="btn btn-sm btn-secondary" id="showMoreHistory">
                –ü–æ–∫–∞–∑–∞—Ç—å –±–æ–ª—å—à–µ
            </button>
        </div>
        <div class="shift-history-list" id="shiftHistoryList">
            <div class="loading-placeholder">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å–º–µ–Ω...</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('‚è∞ Shift page initialized');
    
    // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ WaiterShift
    const waitForShift = () => {
        if (window.waiterShift) {
            console.log('‚úÖ WaiterShift –¥–æ—Å—Ç—É–ø–µ–Ω');
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            setTimeout(() => {
                window.waiterShift.loadCurrentShift();
            }, 100);
        } else {
            console.log('‚è≥ –ñ–¥–µ–º WaiterShift...');
            setTimeout(waitForShift, 100);
        }
    };
    
    waitForShift();
    
    // –ü—Ä–æ—Å—Ç—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ (–¥–µ–ª–µ–≥–∏—Ä—É—é—Ç –Ω–∞ WaiterShift)
    async function startShift() {
        if (window.waiterShift) {
            await window.waiterShift.startShift();
        }
    }
    
    async function endShift() {
        if (window.waiterShift) {
            await window.waiterShift.endShift();
        }
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å–º–µ–Ω
    function loadShiftHistory() {
        const historyList = document.getElementById('shiftHistoryList');
        
        // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É
        setTimeout(() => {
            const sampleHistory = [
                {
                    date: new Date(Date.now() - 24 * 60 * 60 * 1000),
                    duration: '8—á 30–º–∏–Ω',
                    orders: 15,
                    revenue: 1250.00
                },
                {
                    date: new Date(Date.now() - 48 * 60 * 60 * 1000),
                    duration: '7—á 45–º–∏–Ω',
                    orders: 12,
                    revenue: 980.50
                }
            ];
            
            if (sampleHistory.length === 0) {
                historyList.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-history"></i>
                        <h3>–ò—Å—Ç–æ—Ä–∏—è —Å–º–µ–Ω –ø—É—Å—Ç–∞</h3>
                        <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∏—Å—Ç–æ—Ä–∏—è –≤–∞—à–∏—Ö —Å–º–µ–Ω</p>
                    </div>
                `;
                return;
            }
            
            const historyHtml = sampleHistory.map(shift => `
                <div class="history-item">
                    <div class="history-date">
                        ${WaiterUtils.formatDate(shift.date)}
                    </div>
                    <div class="history-stats">
                        <span>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${shift.duration}</span>
                        <span>–ó–∞–∫–∞–∑–æ–≤: ${shift.orders}</span>
                        <span>–í—ã—Ä—É—á–∫–∞: ${WaiterUtils.formatPrice(shift.revenue)}</span>
                    </div>
                </div>
            `).join('');
            
            historyList.innerHTML = historyHtml;
        }, 500);
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    document.getElementById('startShiftBtn').addEventListener('click', startShift);
    document.getElementById('endShiftBtn').addEventListener('click', endShift);
    document.getElementById('refreshShift').addEventListener('click', () => {
        if (window.waiterShift) {
            window.waiterShift.loadCurrentShift();
        }
    });
    document.getElementById('showMoreHistory').addEventListener('click', function() {
        waiterNotifications.showInfo('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
    });
    
    // –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    loadShiftHistory();
});
</script>


{% endblock %}