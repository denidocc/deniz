{% extends "admin/base.html" %}

{% block page_title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã{% endblock %}

{% block extra_css %}
<style>
    .settings-section {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }
    
    .section-header {
        background: var(--admin-primary);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 12px 12px 0 0;
        margin-bottom: 0;
    }
    
    .section-body {
        padding: 1.5rem;
    }
    
    .setting-item {
        border-bottom: 1px solid #eee;
        padding: 1rem 0;
    }
    
    .setting-item:last-child {
        border-bottom: none;
    }
    
    .setting-label {
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
    
    .setting-description {
        font-size: 0.9rem;
        color: #6c757d;
        margin-bottom: 1rem;
    }
    
    .currency-input {
        position: relative;
    }
    
    .currency-input::after {
        content: '‚ÇΩ';
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
    }
    
    .backup-status {
        background: var(--admin-light);
        border-radius: 8px;
        padding: 1rem;
        margin-top: 1rem;
    }
    
    .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 0.5rem;
    }
    
    .status-online {
        background: var(--admin-success);
    }
    
    .status-offline {
        background: var(--admin-danger);
    }
    
    .language-selector {
        display: flex;
        gap: 0.5rem;
    }
    
    .language-option {
        padding: 0.5rem 1rem;
        border: 2px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .language-option.active {
        border-color: var(--admin-accent);
        background: var(--admin-accent);
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-gear"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
    <button class="btn btn-admin" onclick="saveAllSettings()">
        <i class="bi bi-check"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    </button>
</div>

<!-- General Settings -->
<div class="settings-section">
    <div class="section-header">
        <h5 class="mb-0">
            <i class="bi bi-sliders"></i> –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        </h5>
    </div>
    <div class="section-body">
        <div class="setting-item">
            <div class="setting-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</div>
            <div class="setting-description">–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö</div>
            <input type="text" class="form-control" id="restaurantName" 
                   value="{{ settings.get('restaurant_name', 'DENIZ Restaurant') }}">
        </div>
        
        <div class="setting-item">
            <div class="setting-label">–ê–¥—Ä–µ—Å —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</div>
            <div class="setting-description">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —á–µ–∫–∞—Ö –∏ –æ—Ç—á–µ—Ç–∞—Ö</div>
            <textarea class="form-control" id="restaurantAddress" rows="3">{{ settings.get('restaurant_address', '') }}</textarea>
        </div>
        
        <div class="setting-item">
            <div class="setting-label">–¢–µ–ª–µ—Ñ–æ–Ω</div>
            <div class="setting-description">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</div>
            <input type="tel" class="form-control" id="restaurantPhone" 
                   value="{{ settings.get('restaurant_phone', '') }}">
        </div>
        
        <div class="setting-item">
            <div class="setting-label">Email</div>
            <div class="setting-description">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤</div>
            <input type="email" class="form-control" id="restaurantEmail" 
                   value="{{ settings.get('restaurant_email', '') }}">
        </div>
    </div>
</div>

<!-- Financial Settings -->
<div class="settings-section">
    <div class="section-header">
        <h5 class="mb-0">
            <i class="bi bi-calculator"></i> –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        </h5>
    </div>
    <div class="section-body">
        <div class="setting-item">
            <div class="setting-label">–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä (%)</div>
            <div class="setting-description">–ü—Ä–æ—Ü–µ–Ω—Ç —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–±–æ—Ä–∞, –¥–æ–±–∞–≤–ª—è–µ–º—ã–π –∫ —Å—á–µ—Ç—É</div>
            <div class="row">
                <div class="col-md-6">
                    <input type="number" class="form-control" id="serviceCharge" 
                           min="0" max="50" step="0.1" 
                           value="{{ settings.get('service_charge', '10') }}">
                </div>
                <div class="col-md-6">
                    <div class="form-check mt-2">
                        <input class="form-check-input" type="checkbox" id="serviceChargeEnabled" 
                               {{ 'checked' if settings.get('service_charge_enabled', 'true') == 'true' else '' }}>
                        <label class="form-check-label" for="serviceChargeEnabled">
                            –í–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="setting-item">
            <div class="setting-label">–ù–î–° (%)</div>
            <div class="setting-description">–°—Ç–∞–≤–∫–∞ –Ω–∞–ª–æ–≥–∞ –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
            <div class="row">
                <div class="col-md-6">
                    <input type="number" class="form-control" id="vatRate" 
                           min="0" max="50" step="0.1" 
                           value="{{ settings.get('vat_rate', '20') }}">
                </div>
                <div class="col-md-6">
                    <div class="form-check mt-2">
                        <input class="form-check-input" type="checkbox" id="vatEnabled" 
                               {{ 'checked' if settings.get('vat_enabled', 'true') == 'true' else '' }}>
                        <label class="form-check-label" for="vatEnabled">
                            –í–∫–ª—é—á–∏—Ç—å –ù–î–°
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="setting-item">
            <div class="setting-label">–í–∞–ª—é—Ç–∞</div>
            <div class="setting-description">–û—Å–Ω–æ–≤–Ω–∞—è –≤–∞–ª—é—Ç–∞ —Å–∏—Å—Ç–µ–º—ã</div>
            <select class="form-select" id="currency">
                <option value="RUB" {{ 'selected' if settings.get('currency', 'RUB') == 'RUB' else '' }}>–†–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å (‚ÇΩ)</option>
                <option value="USD" {{ 'selected' if settings.get('currency') == 'USD' else '' }}>–î–æ–ª–ª–∞—Ä –°–®–ê ($)</option>
                <option value="EUR" {{ 'selected' if settings.get('currency') == 'EUR' else '' }}>–ï–≤—Ä–æ (‚Ç¨)</option>
                <option value="TMT" {{ 'selected' if settings.get('currency') == 'TMT' else '' }}>–¢—É—Ä–∫–º–µ–Ω—Å–∫–∏–π –º–∞–Ω–∞—Ç (TMT)</option>
            </select>
        </div>
    </div>
</div>

<!-- Language Settings -->
<div class="settings-section">
    <div class="section-header">
        <h5 class="mb-0">
            <i class="bi bi-translate"></i> –Ø–∑—ã–∫–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        </h5>
    </div>
    <div class="section-body">
        <div class="setting-item">
            <div class="setting-label">–Ø–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</div>
            <div class="setting-description">–û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</div>
            <div class="language-selector">
                <div class="language-option {{ 'active' if settings.get('default_language', 'ru') == 'ru' else '' }}" 
                     onclick="selectLanguage('ru')">
                    üá∑üá∫ –†—É—Å—Å–∫–∏–π
                </div>
                <div class="language-option {{ 'active' if settings.get('default_language') == 'en' else '' }}" 
                     onclick="selectLanguage('en')">
                    üá¨üáß English
                </div>
                <div class="language-option {{ 'active' if settings.get('default_language') == 'tr' else '' }}" 
                     onclick="selectLanguage('tr')">
                    üáπüá∑ T√ºrk√ße
                </div>
            </div>
            <input type="hidden" id="defaultLanguage" value="{{ settings.get('default_language', 'ru') }}">
        </div>
        
        <div class="setting-item">
            <div class="setting-label">–î–æ—Å—Ç—É–ø–Ω—ã–µ —è–∑—ã–∫–∏</div>
            <div class="setting-description">–Ø–∑—ã–∫–∏, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
            <div class="row">
                <div class="col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="langRu" checked disabled>
                        <label class="form-check-label" for="langRu">üá∑üá∫ –†—É—Å—Å–∫–∏–π</label>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="langEn" 
                               {{ 'checked' if 'en' in settings.get('available_languages', 'ru,en').split(',') else '' }}>
                        <label class="form-check-label" for="langEn">üá¨üáß English</label>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="langTr" 
                               {{ 'checked' if 'tr' in settings.get('available_languages', 'ru,en').split(',') else '' }}>
                        <label class="form-check-label" for="langTr">üáπüá∑ T√ºrk√ße</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Printer Settings -->
<div class="settings-section">
    <div class="section-header">
        <h5 class="mb-0">
            <i class="bi bi-printer"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—á–∞—Ç–∏
        </h5>
    </div>
    <div class="section-body">
        <div class="setting-item">
            <div class="setting-label">–ü—Ä–∏–Ω—Ç–µ—Ä —á–µ–∫–æ–≤</div>
            <div class="setting-description">IP-–∞–¥—Ä–µ—Å –∏–ª–∏ –∏–º—è –ø—Ä–∏–Ω—Ç–µ—Ä–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏ —á–µ–∫–æ–≤</div>
            <input type="text" class="form-control" id="receiptPrinter" 
                   value="{{ settings.get('receipt_printer', '') }}" 
                   placeholder="192.168.1.100 –∏–ª–∏ PRINTER-01">
        </div>
        
        <div class="setting-item">
            <div class="setting-label">–ü—Ä–∏–Ω—Ç–µ—Ä –∫—É—Ö–Ω–∏</div>
            <div class="setting-description">–ü—Ä–∏–Ω—Ç–µ—Ä –¥–ª—è –ø–µ—á–∞—Ç–∏ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –∫—É—Ö–Ω–µ</div>
            <input type="text" class="form-control" id="kitchenPrinter" 
                   value="{{ settings.get('kitchen_printer', '') }}" 
                   placeholder="192.168.1.101 –∏–ª–∏ KITCHEN-PRINTER">
        </div>
        
        <div class="setting-item">
            <div class="setting-label">–ü—Ä–∏–Ω—Ç–µ—Ä –±–∞—Ä–∞</div>
            <div class="setting-description">–ü—Ä–∏–Ω—Ç–µ—Ä –¥–ª—è –ø–µ—á–∞—Ç–∏ –∑–∞–∫–∞–∑–æ–≤ –≤ –±–∞—Ä–µ</div>
            <input type="text" class="form-control" id="barPrinter" 
                   value="{{ settings.get('bar_printer', '') }}" 
                   placeholder="192.168.1.102 –∏–ª–∏ BAR-PRINTER">
        </div>
        
        <div class="setting-item">
            <div class="setting-label">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—á–∞—Ç—å</div>
            <div class="setting-description">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—á–∞—Ç–∏ –∑–∞–∫–∞–∑–æ–≤</div>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="autoPrintReceipt" 
                               {{ 'checked' if settings.get('auto_print_receipt', 'true') == 'true' else '' }}>
                        <label class="form-check-label" for="autoPrintReceipt">
                            –ü–µ—á–∞—Ç–∞—Ç—å —á–µ–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                        </label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="autoPrintKitchen" 
                               {{ 'checked' if settings.get('auto_print_kitchen', 'true') == 'true' else '' }}>
                        <label class="form-check-label" for="autoPrintKitchen">
                            –ü–µ—á–∞—Ç–∞—Ç—å –∑–∞–∫–∞–∑—ã –Ω–∞ –∫—É—Ö–Ω–µ
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Security Settings -->
<div class="settings-section">
    <div class="section-header">
        <h5 class="mb-0">
            <i class="bi bi-shield-check"></i> –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
        </h5>
    </div>
    <div class="section-body">
        <div class="setting-item">
            <div class="setting-label">–í—Ä–µ–º—è —Å–µ—Å—Å–∏–∏ (–º–∏–Ω—É—Ç—ã)</div>
            <div class="setting-description">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã –ø–æ—Å–ª–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>
            <input type="number" class="form-control" id="sessionTimeout" 
                   min="5" max="480" 
                   value="{{ settings.get('session_timeout', '60') }}">
        </div>
        
        <div class="setting-item">
            <div class="setting-label">PIN –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å—Ç–æ–ª–∞ (–∫–ª–∏–µ–Ω—Ç)</div>
            <div class="setting-description">4-6 —Ü–∏—Ñ—Ä. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–∞—Ö –≥–æ—Å—Ç–µ–π –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤—ã–±–æ—Ä—É —Å—Ç–æ–ª–∞</div>
            <form id="clientPinForm" class="mt-3">
                {{ client_pin_form.hidden_tag() }}
                <div class="row">
                    <div class="col-md-6">
                        <div class="input-group">
                            <input type="text" class="form-control" name="pin" 
                                   placeholder="–í–≤–µ–¥–∏—Ç–µ PIN (4-6 —Ü–∏—Ñ—Ä)" 
                                   pattern="[0-9]{4,6}" maxlength="6"
                                   value="{{ settings.get('table_access_pin', '2112') }}">
                            <button class="btn btn-outline-primary" type="submit">
                                <i class="bi bi-key"></i> –û–±–Ω–æ–≤–∏—Ç—å PIN
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div class="setting-item">
            <div class="setting-label">–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP</div>
            <div class="setting-description">–ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å IP –ø–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞</div>
            <div class="row">
                <div class="col-md-6">
                    <input type="number" class="form-control" id="maxLoginAttempts" 
                           min="3" max="10" 
                           value="{{ settings.get('max_login_attempts', '5') }}"
                           placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫">
                </div>
                <div class="col-md-6">
                    <input type="number" class="form-control" id="blockDuration" 
                           min="5" max="1440" 
                           value="{{ settings.get('block_duration', '30') }}"
                           placeholder="–í—Ä–µ–º—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–º–∏–Ω)">
                </div>
            </div>
        </div>
        
        <div class="setting-item">
            <div class="setting-label">–ê—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π</div>
            <div class="setting-description">–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="auditEnabled" 
                       {{ 'checked' if settings.get('audit_enabled', 'true') == 'true' else '' }}>
                <label class="form-check-label" for="auditEnabled">
                    –í–∫–ª—é—á–∏—Ç—å –∞—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π
                </label>
            </div>
        </div>
    </div>
</div>

<!-- Backup Settings -->
<div class="settings-section">
    <div class="section-header">
        <h5 class="mb-0">
            <i class="bi bi-cloud-arrow-up"></i> –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
        </h5>
    </div>
    <div class="section-body">
        <div class="setting-item">
            <div class="setting-label">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
            <div class="setting-description">–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</div>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="autoBackup" 
                               {{ 'checked' if settings.get('auto_backup', 'true') == 'true' else '' }}>
                        <label class="form-check-label" for="autoBackup">
                            –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–±—ç–∫–∞–ø
                        </label>
                    </div>
                </div>
                <div class="col-md-6">
                    <select class="form-select" id="backupInterval">
                        <option value="daily" {{ 'selected' if settings.get('backup_interval', 'daily') == 'daily' else '' }}>–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
                        <option value="weekly" {{ 'selected' if settings.get('backup_interval') == 'weekly' else '' }}>–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</option>
                        <option value="monthly" {{ 'selected' if settings.get('backup_interval') == 'monthly' else '' }}>–ï–∂–µ–º–µ—Å—è—á–Ω–æ</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="setting-item">
            <div class="setting-label">–•—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π</div>
            <div class="setting-description">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ø–∏–π –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è</div>
            <input type="number" class="form-control" id="backupRetention" 
                   min="1" max="30" 
                   value="{{ settings.get('backup_retention', '7') }}">
        </div>
        
        <div class="setting-item">
            <div class="setting-label">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏</div>
            <div class="setting-description">–°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</div>
            <div class="d-flex gap-2">
                <button class="btn btn-outline-primary" onclick="createBackup()">
                    <i class="bi bi-download"></i> –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
                </button>
                <button class="btn btn-outline-warning" onclick="showRestoreModal()">
                    <i class="bi bi-upload"></i> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –∫–æ–ø–∏–∏
                </button>
            </div>
            
            <div class="backup-status mt-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <span class="status-indicator status-online"></span>
                        –ü–æ—Å–ª–µ–¥–Ω—è—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è: <strong>{{ settings.get('last_backup', '–ù–∏–∫–æ–≥–¥–∞') }}</strong>
                    </div>
                    <div>
                        <small class="text-muted">–†–∞–∑–º–µ—Ä: {{ settings.get('backup_size', '‚Äî') }}</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System Information -->
<div class="settings-section">
    <div class="section-header">
        <h5 class="mb-0">
            <i class="bi bi-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
        </h5>
    </div>
    <div class="section-body">
        <div class="row">
            <div class="col-md-6">
                <div class="setting-item">
                    <div class="setting-label">–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã</div>
                    <div class="setting-description">DENIZ Restaurant v1.0.0</div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-label">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</div>
                    <div class="setting-description">
                        <span class="status-indicator status-online"></span>
                        PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∞
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="setting-item">
                    <div class="setting-label">–ú–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ</div>
                    <div class="setting-description">–°–≤–æ–±–æ–¥–Ω–æ: {{ settings.get('disk_space', '‚Äî') }}</div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-label">–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</div>
                    <div class="setting-description">{{ settings.get('uptime', '‚Äî') }}</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Restore Modal -->
<div class="modal fade" id="restoreModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-upload"></i> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle"></i>
                    <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ —É–¥–∞–ª–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ.
                    –≠—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–º–µ–Ω–µ–Ω–∞.
                </div>
                
                <div class="mb-3">
                    <label for="restoreFile" class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏</label>
                    <input type="file" class="form-control" id="restoreFile" accept=".sql,.backup">
                </div>
                
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="confirmRestore">
                    <label class="form-check-label" for="confirmRestore">
                        –Ø –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-danger" onclick="performRestore()">
                    <i class="bi bi-upload"></i> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Language selection
    function selectLanguage(lang) {
        // Remove active class from all options
        document.querySelectorAll('.language-option').forEach(option => {
            option.classList.remove('active');
        });
        
        // Add active class to selected option
        event.target.classList.add('active');
        
        // Update hidden input
        document.getElementById('defaultLanguage').value = lang;
    }

    // Save all settings
    async function saveAllSettings() {
        const button = event.target;
        const originalText = showLoading(button);
        
        // Collect all settings
        const settings = {
            // General settings
            restaurant_name: document.getElementById('restaurantName').value,
            restaurant_address: document.getElementById('restaurantAddress').value,
            restaurant_phone: document.getElementById('restaurantPhone').value,
            restaurant_email: document.getElementById('restaurantEmail').value,
            
            // Financial settings
            service_charge: document.getElementById('serviceCharge').value,
            service_charge_enabled: document.getElementById('serviceChargeEnabled').checked.toString(),
            vat_rate: document.getElementById('vatRate').value,
            vat_enabled: document.getElementById('vatEnabled').checked.toString(),
            currency: document.getElementById('currency').value,
            
            // Language settings
            default_language: document.getElementById('defaultLanguage').value,
            available_languages: getAvailableLanguages(),
            
            // Printer settings
            receipt_printer: document.getElementById('receiptPrinter').value,
            kitchen_printer: document.getElementById('kitchenPrinter').value,
            bar_printer: document.getElementById('barPrinter').value,
            auto_print_receipt: document.getElementById('autoPrintReceipt').checked.toString(),
            auto_print_kitchen: document.getElementById('autoPrintKitchen').checked.toString(),
            
            // Security settings
            session_timeout: document.getElementById('sessionTimeout').value,
            max_login_attempts: document.getElementById('maxLoginAttempts').value,
            block_duration: document.getElementById('blockDuration').value,
            audit_enabled: document.getElementById('auditEnabled').checked.toString(),
            
            // Backup settings
            auto_backup: document.getElementById('autoBackup').checked.toString(),
            backup_interval: document.getElementById('backupInterval').value,
            backup_retention: document.getElementById('backupRetention').value
        };
        
        try {
            const response = await apiRequest('{{ url_for("admin.update_settings") }}', {
                method: 'POST',
                body: JSON.stringify(settings)
            });
            
            showAlert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
            
        } catch (error) {
            showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫: ' + error.message, 'danger');
        } finally {
            hideLoading(button, originalText);
        }
    }

    // Get available languages
    function getAvailableLanguages() {
        const languages = ['ru']; // Russian is always available
        
        if (document.getElementById('langEn').checked) {
            languages.push('en');
        }
        if (document.getElementById('langTr').checked) {
            languages.push('tk');
        }
        
        return languages.join(',');
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã PIN-–∫–æ–¥–∞ –∫–ª–∏–µ–Ω—Ç–∞
    document.getElementById('clientPinForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const form = e.target;
        const button = form.querySelector('button[type="submit"]');
        const originalText = showLoading(button);
        
        try {
            const formData = new FormData(form);
            const pin = formData.get('pin');
            
            if (!pin || pin.length < 4 || pin.length > 6 || !/^\d+$/.test(pin)) {
                throw new Error('PIN –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 4-6 —Ü–∏—Ñ—Ä');
            }
            
            const response = await apiRequest('/admin/settings/update', {
                method: 'POST',
                body: JSON.stringify({ table_access_pin: pin })
            });
            
            showAlert('PIN-–∫–æ–¥ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω', 'success');
            
        } catch (error) {
            showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ PIN: ' + error.message, 'danger');
        } finally {
            hideLoading(button, originalText);
        }
    });

    // Create backup
    async function createBackup() {
        const button = event.target;
        const originalText = showLoading(button);
        
        try {
            const response = await apiRequest('/admin/backup/create', {
                method: 'POST'
            });
            
            showAlert('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞', 'success');
            
            // Update backup status
            setTimeout(() => {
                location.reload();
            }, 2000);
            
        } catch (error) {
            showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏: ' + error.message, 'danger');
        } finally {
            hideLoading(button, originalText);
        }
    }

    // Show restore modal
    function showRestoreModal() {
        const modal = new bootstrap.Modal(document.getElementById('restoreModal'));
        modal.show();
    }

    // Perform restore
    async function performRestore() {
        const confirmCheckbox = document.getElementById('confirmRestore');
        const fileInput = document.getElementById('restoreFile');
        
        if (!confirmCheckbox.checked) {
            showAlert('–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ, —á—Ç–æ –ø–æ–Ω–∏–º–∞–µ—Ç–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏', 'warning');
            return;
        }
        
        if (!fileInput.files[0]) {
            showAlert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏', 'warning');
            return;
        }
        
        const button = event.target;
        const originalText = showLoading(button);
        
        try {
            const formData = new FormData();
            formData.append('backup_file', fileInput.files[0]);
            
            const response = await fetch('/admin/backup/restore', {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                showAlert('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ. –°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∞.', 'success');
                
                setTimeout(() => {
                    window.location.href = '{{ url_for("auth.login") }}';
                }, 3000);
            } else {
                throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏');
            }
            
        } catch (error) {
            showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏: ' + error.message, 'danger');
        } finally {
            hideLoading(button, originalText);
        }
    }

    // Auto-save on input changes (debounced)
    let saveTimeout;
    document.querySelectorAll('input, select, textarea').forEach(element => {
        element.addEventListener('change', function() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                // Auto-save individual setting
                console.log('Auto-saving setting:', this.id);
            }, 2000);
        });
    });
</script>
{% endblock %}